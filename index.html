<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TimeBomb</title>
</head>
<body>
  <div id="app-wrapper">
  </div>

  <script id="tpl-project-list" type="text/x-handlebars-template">
  </script>

  <script type="text/javascript" charset="utf-8">
    window.$ = window.jQuery = require('jquery');
    var Uuid = require('node-uuid');
    var Datastore = require('nedb');
    var Handlebars = require('handlebars');
    var Moment = require('moment');
    var Utils = require('./utils.js');

    var projectDB = new Datastore({ filename: __dirname + '/db/project.db', autoload: true});
    window.views = 'home';
    window.counter = 0;
    window.timer = null;

    /*on page ready*/
    $(document).ready(function()  {
      populateProjectList();
    });

function populateProjectList()  {
  var projectListTemplate = Handlebars.compile(Utils.templates('home'));
  projectDB.find({}).sort({ name: 1 }).exec(function(err, docs) {
    $('#app-wrapper').html(projectListTemplate({ projects : docs}))

      /*on add project*/
      $('#add-project').on('click', function() {
        var project = {};
        project.created_date = new Date
          project.name = $('#project-name').val();
        projectDB.insert(project, function()  {
          populateProjectList();
        });
      });

    $('.project-list-item').on('click', function()  {
      window.views = 'timer';
      renderProjectTimer($(this).data('project-id'), $(this).data('project-name'));

      $('.timer-start').on('click', function()  {
        window.timer = setInterval(tick, 1000);
      });

      $('.timer-pause').on('click', function()  {
        clearInterval(window.timer);
      });

      $('.timer-stop').on('click', function() {
        clearInterval(window.timer);
        window.counter = 0;
      });
    });
  });
}


function renderProjectTimer(id, name)  {
  var projectListTemplate = Handlebars.compile(Utils.templates('timer'));
  $('#app-wrapper').html(projectListTemplate());


}

function tick() {
  var time = Moment().hour(0).minute(0).second(window.counter++).format('HH : mm : ss');
  $('.timer').html(time);
}

  </script>
</body>
</html>
